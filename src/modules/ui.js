export class UIManager {
  constructor() {
    this.bloomCallback = null;
    this.glowCallback = null;
    this.pulseCallback = null;
    this.bloomModeCallback = null;
    this.modelSelectorCallback = null;
    
  this.pulseEnabled = true;  // –£–≤—ñ–º–∫–Ω—É—Ç–∏ –ø—É–ª—å—Å–∞—Ü—ñ—é –∑–∞ –¥–µ—Ñ–æ–ª—Ç–æ–º
  this.currentModel = 'class-out_emision-in .glb';
    this.glowMode = 'emissive';
  }
  
  setupBloomControls(callback) {
    this.bloomCallback = callback;
    
    // –°–ª–∞–π–¥–µ—Ä–∏ bloom
    this.setupSlider('strength', 'strength-value', (value) => {
      callback({ bloomStrength: parseFloat(value) });
    });
    
    this.setupSlider('threshold', 'threshold-value', (value) => {
      callback({ bloomThreshold: parseFloat(value) });
    });
    
    this.setupSlider('radius', 'radius-value', (value) => {
      callback({ bloomRadius: parseFloat(value) });
    });
    
    this.setupSlider('exposure', 'exposure-value', (value) => {
      callback({ exposure: parseFloat(value) });
    });
  }
  
  setupGlowControls(callback) {
    this.glowCallback = callback;
    
    this.setupSlider('glow-intensity', 'glow-intensity-value', (value) => {
      callback({ intensity: parseFloat(value) });
    });
    
    this.setupSlider('glow-hue', 'glow-hue-value', (value) => {
      callback({ hue: parseFloat(value) });
    });
  }
  
  setupPulseControl(callback) {
    this.pulseCallback = callback;
    
    const pulseButton = document.getElementById('pulse-button');
    if (pulseButton) {
      pulseButton.addEventListener('click', () => {
        this.pulseEnabled = !this.pulseEnabled;
        this.updatePulseButton();
        callback(this.pulseEnabled);
      });
    }
  }
  
  setupBloomModeControl(callback) {
    this.bloomModeCallback = callback;
    
    const bloomModeRadios = document.querySelectorAll('input[name=\"bloom-mode\"]');
    bloomModeRadios.forEach(radio => {
      radio.addEventListener('change', (e) => {
        if (e.target.checked) {
          callback(e.target.value);
        }
      });
    });
  }
  
  setupGlowModeControl(callback) {
    this.glowModeCallback = callback;
    
    const glowModeRadios = document.querySelectorAll('input[name=\"glow-mode\"]');
    glowModeRadios.forEach(radio => {
      radio.addEventListener('change', (e) => {
        if (e.target.checked) {
          callback(e.target.value);
        }
      });
    });
  }
  
  setupModelSelector(callback, fileCallback) {
    this.modelSelectorCallback = callback;
    this.fileUploadCallback = fileCallback;
    
    const modelCards = document.querySelectorAll('.model-card');
    modelCards.forEach(card => {
      card.addEventListener('click', () => {
        const modelPath = card.dataset.model;
        
        // –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∞–∫—Ç–∏–≤–Ω–æ—ó –∫–∞—Ä—Ç–æ—á–∫–∏
        modelCards.forEach(c => c.classList.remove('active'));
        card.classList.add('active');
        
        // –ü—Ä–∏—Ö–æ–≤—É—î–º–æ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ —Ñ–∞–π–ª
        this.clearFileInfo();
        
        this.currentModel = modelPath;
        callback(modelPath);
      });
    });
    
    // –û–±—Ä–æ–±–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ñ–∞–π–ª—ñ–≤
    this.setupFileUpload();
  }
  
  setupFileUpload() {
    const fileInput = document.getElementById('file-input');
    const uploadButton = document.getElementById('upload-button');
    const clearButton = document.getElementById('clear-file');
    
    if (uploadButton && fileInput) {
      uploadButton.addEventListener('click', () => {
        fileInput.click();
      });
      
      fileInput.addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (file) {
          this.handleFileUpload(file);
        }
      });
    }
    
    if (clearButton) {
      clearButton.addEventListener('click', () => {
        this.clearFileInfo();
        if (fileInput) fileInput.value = '';
      });
    }
  }
  
  handleFileUpload(file) {
    // –ü–æ–∫–∞–∑—É—î–º–æ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ —Ñ–∞–π–ª
    const fileInfo = document.getElementById('file-info');
    const fileName = document.getElementById('file-name');
    
    if (fileInfo && fileName) {
      fileName.textContent = `${file.name} (${(file.size / 1024 / 1024).toFixed(2)} MB)`;
      fileInfo.classList.remove('hidden');
    }
    
    // –ü—Ä–∏–±–∏—Ä–∞—î–º–æ –∞–∫—Ç–∏–≤–Ω—ñ –∫–∞—Ä—Ç–æ—á–∫–∏
    const modelCards = document.querySelectorAll('.model-card');
    modelCards.forEach(c => c.classList.remove('active'));
    
    // –í–∏–∫–ª–∏–∫–∞—î–º–æ callback –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
    if (this.fileUploadCallback) {
      this.fileUploadCallback(file);
    }
  }
  
  clearFileInfo() {
    const fileInfo = document.getElementById('file-info');
    if (fileInfo) {
      fileInfo.classList.add('hidden');
    }
  }
  
  setupGlowSettings(callback) {
    this.glowSettingsCallback = callback;
    
    const applyButton = document.getElementById('apply-glow-settings');
    if (applyButton) {
      applyButton.addEventListener('click', () => {
        const settings = {
          eyes: document.getElementById('glow-eyes')?.checked || false,
          lights: document.getElementById('glow-lights')?.checked || false,
          transparent: document.getElementById('glow-transparent')?.checked || false,
          emissive: document.getElementById('glow-emissive')?.checked || false,
          all: document.getElementById('glow-all')?.checked || false
        };
        
        console.log('üéØ –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Å–≤—ñ—á–µ–Ω–Ω—è:', settings);
        callback(settings);
      });
    }
  }
  
  setupCustomLightingControls(callback) {
    this.lightingCallback = callback;
    
    // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —á–∏ —ñ—Å–Ω—É—î —Å–µ–∫—Ü—ñ—è custom lighting (–º–æ–∂–µ –±—É—Ç–∏ –ø—Ä–∏—Ö–æ–≤–∞–Ω–∞)
    const customLightingSection = document.querySelector('.custom-lighting-section');
    if (!customLightingSection) {
      // –°–µ–∫—Ü—ñ—è –ø—Ä–∏—Ö–æ–≤–∞–Ω–∞ - –ø—Ä–æ–ø—É—Å–∫–∞—î–º–æ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è
      console.log('‚ÑπÔ∏è Custom lighting controls –ø—Ä–∏—Ö–æ–≤–∞–Ω—ñ');
      return;
    }
    
    // –°–ª–∞–π–¥–µ—Ä–∏ –æ—Å–≤—ñ—Ç–ª–µ–Ω–Ω—è (—Ç—ñ–ª—å–∫–∏ —è–∫—â–æ —Å–µ–∫—Ü—ñ—è –Ω–µ –ø—Ä–∏—Ö–æ–≤–∞–Ω–∞)
    this.setupSlider('main-light-intensity', 'main-light-value', (value) => {
      callback({ mainIntensity: parseFloat(value) });
    }, true); // silent mode
    
    this.setupSlider('inner-light-intensity', 'inner-light-value', (value) => {
      callback({ innerIntensity: parseFloat(value) });
    }, true);
    
    this.setupSlider('bottom-light-intensity', 'bottom-light-value', (value) => {
      callback({ bottomIntensity: parseFloat(value) });
    }, true);
    
    // –ö–æ–ª—ñ—Ä –≤–Ω—É—Ç—Ä—ñ—à–Ω—å–æ–≥–æ —Å–≤—ñ—Ç–ª–∞
    const colorPicker = document.getElementById('inner-light-color');
    if (colorPicker) {
      colorPicker.addEventListener('input', (e) => {
        callback({ innerColor: e.target.value });
      });
    }
    
    // –ö–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–Ω—è –æ—Å–≤—ñ—Ç–ª–µ–Ω–Ω—è
    const toggleButton = document.getElementById('toggle-lighting');
    if (toggleButton) {
      let useCustomLighting = true;
      toggleButton.addEventListener('click', () => {
        useCustomLighting = !useCustomLighting;
        callback({ 
          toggleLighting: true, 
          useCustom: useCustomLighting 
        });
        
        toggleButton.textContent = useCustomLighting 
          ? 'üîÑ –û—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–µ/–í–ª–∞—Å–Ω–µ —Å–≤—ñ—Ç–ª–æ (–í–ª–∞—Å–Ω–µ)' 
          : 'üîÑ –û—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–µ/–í–ª–∞—Å–Ω–µ —Å–≤—ñ—Ç–ª–æ (–û—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–µ)';
      });
    }
  }
  
  setupSlider(sliderId, valueId, callback, silent = false) {
    const slider = document.getElementById(sliderId);
    const valueDisplay = document.getElementById(valueId);
    
    if (slider && valueDisplay) {
      slider.addEventListener('input', (e) => {
        const value = e.target.value;
        valueDisplay.textContent = value;
        callback(value);
      });
      
      // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –ø–æ—á–∞—Ç–∫–æ–≤–æ–≥–æ –∑–Ω–∞—á–µ–Ω–Ω—è
      valueDisplay.textContent = slider.value;
    } else if (!silent) {
      // –ü–æ–∫–∞–∑—É—î–º–æ –ø–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è —Ç—ñ–ª—å–∫–∏ —è–∫—â–æ –Ω–µ –≤ silent —Ä–µ–∂–∏–º—ñ
      console.warn(`–ù–µ –∑–Ω–∞–π–¥–µ–Ω–æ –µ–ª–µ–º–µ–Ω—Ç–∏ –¥–ª—è —Å–ª–∞–π–¥–µ—Ä–∞: ${sliderId}`);
    }
  }
  
  updatePulseButton() {
    const pulseButton = document.getElementById('pulse-button');
    if (pulseButton) {
      pulseButton.textContent = this.pulseEnabled ? 
        'üî¥ –í–∏–º–∫–Ω—É—Ç–∏ –ø—É–ª—å—Å–∞—Ü—ñ—é' : 
        'üí´ –£–≤—ñ–º–∫–Ω—É—Ç–∏ –ø—É–ª—å—Å–∞—Ü—ñ—é';
      
      pulseButton.style.background = this.pulseEnabled ?
        'linear-gradient(45deg, #ff6b6b 0%, #ee5a52 100%)' :
        'linear-gradient(45deg, #667eea 0%, #764ba2 100%)';
    }
  }
  
  setLoading(isLoading) {
    const loadingIndicator = document.getElementById('loading-indicator');
    if (loadingIndicator) {
      if (isLoading) {
        loadingIndicator.classList.remove('hidden');
      } else {
        loadingIndicator.classList.add('hidden');
      }
    }
  }
  
  showNotification(message, type = 'info') {
    // –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç–∞ –ø–æ–∫–∞–∑ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è
    const notification = document.createElement('div');
    notification.className = `notification notification-${type}`;
    notification.textContent = message;
    
    // –°—Ç–∏–ª—ñ –¥–ª—è —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è
    Object.assign(notification.style, {
      position: 'fixed',
      top: '20px',
      left: '50%',
      transform: 'translateX(-50%)',
      padding: '12px 20px',
      borderRadius: '8px',
      color: 'white',
      fontSize: '14px',
      fontWeight: '500',
      zIndex: '10000',
      opacity: '0',
      transition: 'opacity 0.3s ease',
      pointerEvents: 'none'
    });
    
    // –ö–æ–ª—å–æ—Ä–∏ –∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ —Ç–∏–ø—É
    const colors = {
      info: 'rgba(79, 158, 255, 0.9)',
      success: 'rgba(76, 175, 80, 0.9)',
      warning: 'rgba(255, 193, 7, 0.9)',
      error: 'rgba(244, 67, 54, 0.9)'
    };
    
    notification.style.background = colors[type] || colors.info;
    
    document.body.appendChild(notification);
    
    // –ê–Ω—ñ–º–∞—Ü—ñ—è –ø–æ—è–≤–∏
    requestAnimationFrame(() => {
      notification.style.opacity = '1';
    });
    
    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –ø—Ä–∏—Ö–æ–≤–∞–Ω–Ω—è
    setTimeout(() => {
      notification.style.opacity = '0';
      setTimeout(() => {
        if (notification.parentNode) {
          notification.parentNode.removeChild(notification);
        }
      }, 300);
    }, 3000);
  }
  
  updateModelPreview(modelPath) {
    // –û–Ω–æ–≤–ª–µ–Ω–Ω—è –ø—Ä–µ–≤—å—é –º–æ–¥–µ–ª—ñ (—è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ)
    const modelCards = document.querySelectorAll('.model-card');
    modelCards.forEach(card => {
      if (card.dataset.model === modelPath) {
        card.classList.add('active');
      } else {
        card.classList.remove('active');
      }
    });
  }
  
  getControlValues() {
    return {
      bloomStrength: parseFloat(document.getElementById('strength')?.value || 1),
      bloomThreshold: parseFloat(document.getElementById('threshold')?.value || 0.1),
      bloomRadius: parseFloat(document.getElementById('radius')?.value || 0.55),
      exposure: parseFloat(document.getElementById('exposure')?.value || 0.1),
      glowIntensity: parseFloat(document.getElementById('glow-intensity')?.value || 2.9),
      glowHue: parseFloat(document.getElementById('glow-hue')?.value || 0.06),
      bloomMode: document.querySelector('input[name=\"bloom-mode\"]:checked')?.value || 'simple',
      currentModel: this.currentModel
    };
  }
}